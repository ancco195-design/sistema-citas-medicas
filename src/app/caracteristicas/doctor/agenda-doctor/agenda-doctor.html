<app-navbar></app-navbar>

<div class="container fade-in">
  <h1>GestiÃ³n de Agenda</h1>
  <p class="subtitle">Administra tus consultas asignadas</p>

  <!-- FILTROS -->
  <div class="filtros-container">
    <div class="filtros">
      <!-- Filtro Fecha -->
      <div class="filtro-item">
        <label>ğŸ“… Fecha:</label>
        <input 
          type="date" 
          [(ngModel)]="filtroFecha" 
          (change)="aplicarFiltros()"
          class="input-filtro">
      </div>

      <!-- Filtro Especialidad -->
      <div class="filtro-item">
        <label>ğŸ©º Especialidad:</label>
        <select 
          [(ngModel)]="filtroEspecialidad" 
          (change)="aplicarFiltros()"
          class="input-filtro">
          <option value="">Todas</option>
          <option *ngFor="let esp of especialidades" [value]="esp">{{ esp }}</option>
        </select>
      </div>

      <!-- Filtro Estado -->
      <div class="filtro-item">
        <label>ğŸ“Š Estado:</label>
        <select 
          [(ngModel)]="filtroEstado" 
          (change)="aplicarFiltros()"
          class="input-filtro">
          <option value="todas">Todas</option>
          <option value="pendiente">Pendiente</option>
          <option value="confirmada">Confirmada</option>
          <option value="completada">Completada</option>
          <option value="cancelada">Cancelada</option>
        </select>
      </div>

      <!-- BotÃ³n Limpiar -->
      <button class="btn-limpiar" (click)="limpiarFiltros()">
        ğŸ”„ Limpiar
      </button>
    </div>
  </div>

  <div *ngIf="cargando" class="loading-spinner">
    <div class="spinner"></div> Cargando agenda...
  </div>

  <div *ngIf="!cargando">
    
    <div *ngIf="citasFiltradas.length === 0" class="empty-state">
      <p>No hay citas que coincidan con los filtros.</p>
    </div>

    <div class="lista-agenda">
      <div *ngFor="let cita of citasFiltradas" 
           class="fila-cita" 
           [ngClass]="cita.estado"
           (click)="verDetalle(cita.id!)">
        
        <!-- Fecha Grande -->
        <div class="col-fecha">
          <span class="dia">{{ formatearFecha(cita.fecha) | date:'dd' }}</span>
          <span class="mes">{{ formatearFecha(cita.fecha) | date:'MMM' | uppercase }}</span>
        </div>

        <!-- Info Paciente -->
        <div class="col-info">
          <h3>{{ cita.pacienteNombre || 'Paciente sin nombre' }}</h3>
          <p class="hora-badge">ğŸ•’ {{ cita.hora }}</p>
          <p class="motivo">"{{ cita.motivo }}"</p>
        </div>

        <!-- Estado -->
        <div class="col-estado">
          <span class="badge" [ngClass]="cita.estado">{{ cita.estado | uppercase }}</span>
        </div>

        <!-- Acciones RÃ¡pidas -->
        <div class="col-acciones">
          <ng-container *ngIf="procesandoId !== cita.id; else spinnerBtn">
            
            <div *ngIf="cita.estado === 'pendiente'" class="btn-group">
              <button (click)="gestionarCita(cita, 'confirmar', $event)" class="btn-icon check" title="Aceptar">âœ“</button>
              <button (click)="gestionarCita(cita, 'cancelar', $event)" class="btn-icon cross" title="Rechazar">âœ•</button>
            </div>

            <div *ngIf="cita.estado === 'confirmada'">
              <button (click)="gestionarCita(cita, 'completar', $event)" class="btn-completar">
                Atender
              </button>
            </div>

          </ng-container>
          
          <ng-template #spinnerBtn>
            <span class="mini-loader">âŒ›</span>
          </ng-template>
        </div>

      </div>
    </div>
  </div>
</div>